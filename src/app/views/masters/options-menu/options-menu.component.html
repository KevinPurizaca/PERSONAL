<p-panel header="Busqueda de Modulo">

    <form  [formGroup]="formSearch">
        <div class="p-fluid grid p-formgrid">
            <div class="col-12 md:col-3">
                <label class="label-filter-text">Titulo</label>
                <input formControlName="txtTitle" type="text" pInputText class="p-inputtext p-component p-element" />
            </div>

            <div class="col-12 md:col-3">
                <label class="label-filter-text">Visibles</label>
                <p-dropdown formControlName="intVisible"  [placeholder]="vMessageSelect" 
                optionLabel="value" optionValue="id"   [emptyMessage]="vMessageEmpty" [options]="lstStatus" ></p-dropdown>
            </div>

            <div class="col-12 md:col-3">
                <label class="label-filter-text">Tienen Sub Menu</label>
                <p-dropdown formControlName="intSubMenu"  [placeholder]="vMessageSelect" 
                optionLabel="value" optionValue="id"   [emptyMessage]="vMessageEmpty" [options]="lstStatus" ></p-dropdown>
            </div>
            <div class="col-12 md:col-3">
              <label class="label-filter-text">Estado</label>                
              <p-dropdown formControlName="intStatus"  [placeholder]="vMessageSelect" 
              optionLabel="value" optionValue="id" appendTo="body"
              [emptyMessage]="vMessageEmpty" [options]="lstState" ></p-dropdown>
            </div>
        </div>

        <div class="flex flex-wrap sm:flex-row">
            <div class="sm:mr-auto mb-3 mr-3">
              <button pButton label="Agregar Modulo" type="button" icon="pi pi-plus" class="p-button-help" (click)="viewModal(1,null)"></button>
            </div>
            <div class="mb-3 mr-3">
              <button pButton label="Buscar" icon="pi pi-search" type="submit" class="p-button-outlined p-button-primary"></button>
            </div>
            <div class="">
              <button pButton (click)="formSearch.reset()" label="Limpiar" type="button" icon="pi pi-trash" class="p-button-outlined p-button-secondary"></button>
            </div>
          </div>

    </form>
</p-panel>

<br>

<p-panel header="Resultados de Modulos">
    <p-table [value]="lstModules" scrollDirection="both" [scrollable]="true" scrollHeight="400px" styleClass="mt-3" responsiveLayout="scroll">
        <ng-template pTemplate="header">
          <tr>
            <th style="min-width:100px">Id</th>
            <th style="min-width:100px">Titulo</th>
            <th style="min-width:100px">Url</th>
            <th style="min-width:100px">Icono</th>
            <th style="min-width:100px">Orden</th>
            <th style="min-width:100px">Visible</th>
            <th style="min-width:100px">Sub menu</th>
            <th style="min-width:100px">Estado</th>    
            <th style="min-width:100px" pFrozenColumn alignFrozen="right">Acciones</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-customer>
          <tr>
            <td style="width:200px" pFrozenColumn class="font-bold">{{customer.name}}</td>
            <td style="width:200px" alignFrozen="left" pFrozenColumn [frozen]="idFrozen" [ngClass]="{'font-bold': idFrozen}">{{customer.id}}</td>
            <td style="width:200px">
              <span class="image-text ml-2">{{customer.country.name}}</span>
            </td>
            <td style="width:200px">{{customer.date}}</td>
            <td style="width:200px">{{customer.company}}</td>
            <td style="width:200px">
              <span [class]="'customer-badge status-' + customer.status">{{customer.status}}</span>
            </td>
            <td style="width:200px">{{customer.activity}}</td>
            <td style="width:200px">
              <span class="image-text ml-2">{{customer.representative.name}}</span>
            </td>
            <td style="width:200px" pFrozenColumn  class="font-bold" alignFrozen="right">{{formatCurrency(customer.balance)}}</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="7">No se encontró Información.</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody">
          <tr>
            <td colspan="7">
              Cargando información. Espere por favor.
            </td>
          </tr>
        </ng-template>
      </p-table>
      <p-paginator [rows]="req.itotal_pagina" [totalRecords]="totalRecord" [rowsPerPageOptions]="rowsOptions"
      [showCurrentPageReport]="true" [first]="first"
      currentPageReportTemplate="Total : {totalRecords} registros"></p-paginator>
</p-panel>


<p-dialog [(visible)]="vmEditRegisterModule" [draggable]="false" [style]="{width: '440px',height:'500px'}"  [closable]="false" [header]="titleEditRegisterModule"
  [modal]="true" class="p-fluid">
  <ng-template pTemplate="content">
    <br>
   <form [formGroup]="formRegisterEdit">
    <div class="p-fluid p-formgrid grid">
      
      <div class="col-12 md:col-6">
        <label class="label-filter-text">Titulo</label>
        <input formControlName="txtTitle" type="text" pInputText class="p-inputtext p-component p-element"     />

          <small  *ngIf="formRegisterEdit.controls['txtTitle'].invalid && formRegisterEdit.controls['txtTitle'].touched"
          class="text-red-600"> Ingrese Titulo</small>
      </div>

      
      <div class="col-12 md:col-6">
        <label class="label-filter-text">URL</label>
        <input formControlName="txtUrl" type="text" pInputText class="p-inputtext p-component p-element"    />

           <small  *ngIf="formRegisterEdit.controls['txtUrl'].invalid && formRegisterEdit.controls['txtUrl'].touched"
          class="text-red-600"> Ingrese URL</small>       
      </div>
 
      <div class="col-12 md:col-6">
        <label class="label-filter-text">Orden</label>
        <p-inputNumber formControlName="txtOrder" inputId="withoutgrouping" [useGrouping]="false" 
        [maxlength]="2" autocomplete="off"></p-inputNumber> 

           <small  *ngIf="formRegisterEdit.controls['txtOrder'].invalid && formRegisterEdit.controls['txtOrder'].touched"
          class="text-red-600"> Ingrese Orden</small>
       
      </div>


      <div class="col-12 md:col-6">
        <label class="label-filter-text">Icono</label>                


        <p-dropdown formControlName="intIcon" [filter]="true" [options]="lstIcons" [(ngModel)]="selectedIcon" 
        optionValue="value" optionLabel="value" [placeholder]="vMessageSelect" appendTo="body"  [emptyMessage]="vMessageEmpty"
        [virtualScroll]="true" [virtualScrollItemSize]="38" [virtualScrollOptions]="options"
            (onChange)="selectIcon($event)" (onFilter)="filterIcon($event)">
            <ng-template pTemplate="selectedItem">
                <div class="flex align-items-center gap-2" *ngIf="selectedIcon">
                    <i [class]="'pi pi-'+selectedIcon"></i>
                    <div>{{ selectedIcon }}</div>
                </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
                <div class="flex align-items-center gap-2">
                    <i [class]="'pi pi-'+item.value"></i>
                    <div>{{ item.value }}</div>
                </div>
            </ng-template>
            <ng-template let-item pTemplate="loader">
                <div >
                    <p-skeleton styleClass="mb-2" borderRadius="16px"></p-skeleton>
                    <p-skeleton width="10rem" styleClass="mb-2" borderRadius="16px"></p-skeleton>
                    <p-skeleton styleClass="mb-2" borderRadius="16px"></p-skeleton>
                    <p-skeleton width="10rem" styleClass="mb-2" borderRadius="16px"></p-skeleton>

                </div>
            </ng-template>
        </p-dropdown>


         <small  *ngIf="formRegisterEdit.controls['intIcon'].invalid && formRegisterEdit.controls['intIcon'].touched"
        class="text-red-600"> Seleccion Icono.</small>
      </div>

      <div class="col-12 md:col-3">
        <label class="label-filter-text">Visible</label>                
        <div class="flex justify-content-start">
            <p-checkbox formControlName="intVisible"
             class="ml-4" [(ngModel)]="lsModuleDto.visible" [binary]="true" inputId="binary"></p-checkbox>
        </div>
        
      </div>

      <div class="col-12 md:col-3">
        <label class="label-filter-text">Sub Menu</label>                
        <div class="flex justify-content-start" >
            <p-checkbox formControlName="intSubMenu" class="ml-4" [(ngModel)]="lsModuleDto.sub_menu" [binary]="true" inputId="binary"></p-checkbox>
        </div>
      </div>

      <div class="col-12 md:col-6">
        <label class="label-filter-text">Estado</label>                
        <p-dropdown formControlName="intState" [options]="lstStatus" optionLabel="value" optionValue="id"
        [emptyMessage]="vMessageEmpty" [placeholder]="vMessageSelect" required appendTo="body"></p-dropdown>

        <small  *ngIf="formRegisterEdit.controls['intState'].invalid && formRegisterEdit.controls['intState'].touched"
        class="text-red-600"> Seleccion Estado.</small>
      </div>




    </div>   
   </form>
  </ng-template>

  <ng-template pTemplate="footer">
    <button pButton pRipple label="Cerrar" icon="pi pi-times" class="p-button-text" (click)="vmEditRegisterModule = false;"></button>
    <button pButton pRipple label="Guardar" icon="pi pi-save" class="p-button-text" [loading]="loadingSave" (click)="saveModule()" ></button>
  </ng-template>
</p-dialog>
